<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฎุจูุฑ ุงููุญุงุณุจู</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<div class="wrap no-print">
    <div class="card">
        <div class="header">
            <h2>ุงูุฎุจูุฑ ุงููุญุงุณุจู</h2>
            <div>
                <span id="userDisplay" style="margin-left: 10px; font-weight: bold;"></span>
                <button class="btn danger" onclick="logout()">ุฎุฑูุฌ</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('tabSales')">ูุจูุนุงุช</button>
            <button class="tab-btn" onclick="showTab('tabPurchases')">ูุดุชุฑูุงุช</button>
            <button class="tab-btn" onclick="showTab('tabReceipts')">ุณูุฏุงุช</button>
            <button class="tab-btn" onclick="showTab('tabItems')">ุฃุตูุงู</button>
            <button class="tab-btn" onclick="showTab('tabCustomers')">ุนููุงุก</button>
            <button class="tab-btn" onclick="showTab('tabSuppliers')">ููุฑุฏูู</button>
            <button class="tab-btn" onclick="showTab('tabReports')">ุชูุงุฑูุฑ</button>
            <button class="tab-btn" onclick="showTab('tabSettings')">ุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- Sales Tab -->
        <div id="tabSales" class="tab-content active">
            <div class="row">
                <div class="col"><button class="btn" onclick="newInvoice()">โ ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</button></div>
                <div class="col"><button class="btn success" onclick="saveInvoice()">๐พ ุญูุธ ุงููุงุชูุฑุฉ</button></div>
            </div>
            <div class="row" style="background:#f9f9f9; padding:10px; border-radius:5px;">
                <div class="col">
                    <label>ุฑูู ุงููุงุชูุฑุฉ</label>
                    <input type="text" id="invNum">
                    <small id="nextInvHint" style="color:green"></small>
                </div>
                <div class="col"><label>ุงูุชุงุฑูุฎ</label><input type="datetime-local" id="invDate"></div>
                <div class="col">
                    <label>ุงูุนููู</label>
                    <input type="text" id="invCust" list="dlCustomers" oninput="checkDebt(this.value)">
                    <div id="debtBox" class="debt-box"></div>
                </div>
            </div>
            <table>
                <thead><tr><th>ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุงูุฅุฌูุงูู</th><th>ุญุฐู</th></tr></thead>
                <tbody id="invItems"></tbody>
            </table>
            <button class="btn secondary" onclick="addInvRow()" style="margin-top:5px">โ ุฅุถุงูุฉ ุตูู</button>
            <div class="summary">
                <h3>ุงูุฅุฌูุงูู: <span id="invTotal">0.00</span> | ุงูุถุฑูุจุฉ: <span id="invVat">0.00</span> | ุงูุตุงูู: <span id="invGrand">0.00</span></h3>
            </div>
            <hr>
            <h3>ุณุฌู ุงูููุงุชูุฑ</h3>
            <table id="tblInvoices"><thead><tr><th>ุงูุฑูู</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูุนููู</th><th>ุงููุจูุบ</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Purchases Tab -->
        <div id="tabPurchases" class="tab-content">
            <div class="row">
                <div class="col"><button class="btn" onclick="newPurchase()">โ ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ</button></div>
                <div class="col"><button class="btn success" onclick="savePurchase()">๐พ ุญูุธ ุงูุดุฑุงุก</button></div>
            </div>
            <div class="row">
                <div class="col"><label>ุฑูู ูุงุชูุฑุฉ ุงูููุฑุฏ</label><input type="text" id="purNum"></div>
                <div class="col"><label>ุงูุชุงุฑูุฎ</label><input type="datetime-local" id="purDate"></div>
                <div class="col"><label>ุงูููุฑุฏ</label><input type="text" id="purSup" list="dlSuppliers"></div>
            </div>
            <table>
                <thead><tr><th>ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงูุชูููุฉ</th><th>ุงูุฅุฌูุงูู</th><th>ุญุฐู</th></tr></thead>
                <tbody id="purItems"></tbody>
            </table>
            <button class="btn secondary" onclick="addPurRow()" style="margin-top:5px">โ ุฅุถุงูุฉ ุตูู</button>
            <div class="summary"><h3>ุงูุฅุฌูุงูู: <span id="purTotal">0.00</span></h3></div>
            <hr>
            <h3>ุณุฌู ุงููุดุชุฑูุงุช</h3>
            <table id="tblPurchases"><thead><tr><th>ุงูุฑูู</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูููุฑุฏ</th><th>ุงููุจูุบ</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Receipts Tab -->
        <div id="tabReceipts" class="tab-content">
            <div class="row">
                <div class="col"><button class="btn" onclick="newReceipt()">โ ุณูุฏ ุฌุฏูุฏ</button></div>
                <div class="col"><button class="btn success" onclick="saveReceipt()">๐พ ุญูุธ ุงูุณูุฏ</button></div>
            </div>
            <div class="row">
                <div class="col"><label>ุฑูู ุงูุณูุฏ</label><input type="text" id="recNum"></div>
                <div class="col"><label>ุงูุชุงุฑูุฎ</label><input type="datetime-local" id="recDate"></div>
                <div class="col">
                    <label>ุงูุนููู</label>
                    <input type="text" id="recCust" list="dlCustomers" oninput="showRecBalance(this.value)">
                    <small id="recBalanceHint" style="color:blue; font-weight:bold"></small>
                </div>
            </div>
            <div class="row">
                <div class="col"><label>ุงููุจูุบ</label><input type="number" id="recAmount"></div>
                <div class="col"><label>ุทุฑููุฉ ุงูุฏูุน</label><select id="recType"><option>ููุฏู</option><option>ุชุญููู</option><option>ุดุจูุฉ</option></select></div>
                <div class="col"><label>ููุงุญุธุงุช</label><input type="text" id="recNote"></div>
            </div>
            <hr>
            <h3>ุณุฌู ุงูุณูุฏุงุช</h3>
            <table id="tblReceipts"><thead><tr><th>ุงูุฑูู</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูุนููู</th><th>ุงููุจูุบ</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Items Tab -->
        <div id="tabItems" class="tab-content">
            <div class="row">
                <div class="col"><label>ุงุณู ุงูุตูู</label><input type="text" id="itmName"></div>
                <div class="col"><label>ุณุนุฑ ุงูุจูุน</label><input type="number" id="itmPrice"></div>
                <div class="col"><br><button class="btn success" onclick="saveItem()">ุญูุธ ุงูุตูู</button></div>
            </div>
            <table id="tblItems"><thead><tr><th>ุงูุตูู</th><th>ุงูุณุนุฑ</th><th>ูุจุงุน</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Customers Tab -->
        <div id="tabCustomers" class="tab-content">
            <div class="row">
                <div class="col"><label>ุงุณู ุงูุนููู</label><input type="text" id="custName"></div>
                <div class="col"><label>ุงูุฑูู ุงูุถุฑูุจู</label><input type="text" id="custTax"></div>
                <div class="col"><label>ุฌูุงู</label><input type="text" id="custPhone"></div>
            </div>
            <label>ุงูุนููุงู ุงููุทูู</label>
            <div class="address-grid">
                <input id="custCity" placeholder="ุงููุฏููุฉ"><input id="custDist" placeholder="ุงูุญู">
                <input id="custSt" placeholder="ุงูุดุงุฑุน"><input id="custBuild" placeholder="ูุจูู">
                <input id="custZip" placeholder="ุฑูุฒ ุจุฑูุฏู"><input id="custAdd" placeholder="ุฑูู ุฅุถุงูู">
            </div>
            <button class="btn success" onclick="saveCustomer()" style="margin-top:10px">ุญูุธ ุงูุนููู</button>
            <hr>
            <table id="tblCustomers"><thead><tr><th>ุงูุงุณู</th><th>ุงูุฑูู ุงูุถุฑูุจู</th><th>ุฌูุงู</th><th>ุงูุฑุตูุฏ</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Suppliers Tab -->
        <div id="tabSuppliers" class="tab-content">
            <div class="row">
                <div class="col"><label>ุงุณู ุงูููุฑุฏ</label><input type="text" id="supName"></div>
                <div class="col"><label>ุงูุฑูู ุงูุถุฑูุจู</label><input type="text" id="supTax"></div>
                <div class="col"><label>ุฌูุงู</label><input type="text" id="supPhone"></div>
            </div>
            <label>ุงูุนููุงู ุงููุทูู</label>
            <div class="address-grid">
                <input id="supCity" placeholder="ุงููุฏููุฉ"><input id="supDist" placeholder="ุงูุญู">
                <input id="supSt" placeholder="ุงูุดุงุฑุน"><input id="supBuild" placeholder="ูุจูู">
                <input id="supZip" placeholder="ุฑูุฒ ุจุฑูุฏู"><input id="supAdd" placeholder="ุฑูู ุฅุถุงูู">
            </div>
            <button class="btn success" onclick="saveSupplier()" style="margin-top:10px">ุญูุธ ุงูููุฑุฏ</button>
            <hr>
            <table id="tblSuppliers"><thead><tr><th>ุงูุงุณู</th><th>ุงูุฑูู ุงูุถุฑูุจู</th><th>ุฌูุงู</th><th>ุชุญูู</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- Reports Tab -->
        <div id="tabReports" class="tab-content">
            <div class="row" style="background:#eee; padding:15px; border-radius:5px">
                <div class="col">
                    <label>ููุน ุงูุชูุฑูุฑ</label>
                    <select id="repType">
                        <option value="sales">ูุจูุนุงุช</option>
                        <option value="purchases">ูุดุชุฑูุงุช</option>
                        <option value="inventory">ูุฎุฒูู</option>
                        <option value="collections">ุชุญุตููุงุช</option>
                        <option value="debts">ูุฏููููุฉ ุนููุงุก</option>
                    </select>
                </div>
                <div class="col"><label>ูู</label><input type="date" id="repStart"></div>
                <div class="col"><label>ุฅูู</label><input type="date" id="repEnd"></div>
                <div class="col">
                    <br>
                    <button class="btn success" onclick="runReport()">ุนุฑุถ</button>
                    <button class="btn warning" onclick="printReportDiv()">ุทุจุงุนุฉ</button>
                    <button class="btn secondary" onclick="exportReport()">Excel</button>
                </div>
            </div>
            <div id="reportOutput" class="report-area" style="margin-top:20px">
                <h3 id="repTitle" style="text-align:center"></h3>
                <div id="repCards" class="report-cards"></div>
                <table id="tblReport"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="tabSettings" class="tab-content">
            <div class="row">
                <div class="col">
                    <label>ุงุณู ุงูุดุฑูุฉ</label><input type="text" id="setCoName">
                    <label>ุงูุฑูู ุงูุถุฑูุจู</label><input type="text" id="setTax">
                    <label>ุงููุงุชู</label><input type="text" id="setPhone">
                </div>
                <div class="col">
                    <label>ุดุนุงุฑ ุงูุดุฑูุฉ</label>
                    <input type="file" id="setLogoFile" onchange="loadLogo(this)">
                    <img id="setLogoPreview" class="logo-preview">
                </div>
            </div>
            <label>ุงูุนููุงู ุงููุทูู ููุดุฑูุฉ</label>
            <div class="address-grid">
                <input id="setCity" placeholder="ุงููุฏููุฉ"><input id="setDist" placeholder="ุงูุญู">
                <input id="setSt" placeholder="ุงูุดุงุฑุน"><input id="setBuild" placeholder="ูุจูู">
                <input id="setZip" placeholder="ุฑูุฒ ุจุฑูุฏู"><input id="setAdd" placeholder="ุฑูู ุฅุถุงูู">
            </div>
            <button class="btn success" onclick="saveSettings()" style="margin-top:10px">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            <hr>
            <div class="row">
                <div class="col"><button class="btn" onclick="exportData()">ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button></div>
                <div class="col"><input type="file" id="importFile" onchange="importData(this)"></div>
                <div class="col"><button class="btn danger" onclick="wipeData()">ูุณุญ ูู ุงูุจูุงูุงุช</button></div>
            </div>
        </div>
    </div>
</div>

<!-- Datalists -->
<datalist id="dlCustomers"></datalist>
<datalist id="dlSuppliers"></datalist>
<datalist id="dlItems"></datalist>

<!-- Print Divs -->
<div id="printInvoiceDiv" class="print-area">
    <div class="print-header">
        <div>
            <h2 id="pInvCo"></h2>
            <p id="pInvCoDet"></p>
            <p id="pInvAddr"></p>
        </div>
        <div>
            <img id="pInvLogo" class="print-logo">
            <div id="pInvQR" style="margin-top:5px"></div>
        </div>
    </div>
    <h2 style="text-align:center">ูุงุชูุฑุฉ ุถุฑูุจูุฉ</h2>
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <div id="pInvCust"></div>
        <div style="text-align:left">
            <p><strong>ุงูุฑูู:</strong> <span id="pInvNum"></span></p>
            <p><strong>ุงูุชุงุฑูุฎ:</strong> <span id="pInvDate"></span></p>
        </div>
    </div>
    <table id="pInvTable"><thead><tr><th>ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุงูุฅุฌูุงูู</th></tr></thead><tbody></tbody></table>
    <div style="text-align:left; margin-top:10px">
        <h3>ุงูุฅุฌูุงูู ุงูููุงุฆู: <span id="pInvGrand"></span></h3>
    </div>
</div>

<div id="printReceiptDiv" class="print-area">
    <div class="print-header">
        <div><h2 id="pRecCo"></h2><p id="pRecCoDet"></p></div>
        <img id="pRecLogo" class="print-logo">
    </div>
    <h2 style="text-align:center">ุณูุฏ ูุจุถ</h2>
    <div style="border:1px solid #000; padding:15px; margin-top:20px; line-height:2">
        <p><strong>ุฑูู ุงูุณูุฏ:</strong> <span id="pRecNum"></span> <span style="float:left"><strong>ุงูุชุงุฑูุฎ:</strong> <span id="pRecDate"></span></span></p>
        <p><strong>ุงุณุชูููุง ูู ุงูุณูุฏ/ุงูุณุงุฏุฉ:</strong> <span id="pRecCust"></span></p>
        <p><strong>ูุจูุบ ููุฏุฑู:</strong> <span id="pRecAmount"></span> ุฑูุงู</p>
        <p><strong>ูุฐูู ุนู:</strong> <span id="pRecNote"></span></p>
        <p><strong>ุทุฑููุฉ ุงูุฏูุน:</strong> <span id="pRecType"></span></p>
    </div>
    <div style="margin-top:30px; display:flex; justify-content:space-between">
        <p>ุงููุณุชูู: .................</p>
        <p>ุงูุฎุชู ูุงูุชูููุน</p>
    </div>
</div>

<div id="printReportDiv" class="print-area">
    <div style="text-align:center">
        <h2 id="pRepCo"></h2>
        <h3 id="pRepTitle"></h3>
    </div>
    <div id="pRepContent"></div>
</div>

<script src="main.js"></script>
</body>
</html>
