:root{
    --accent:#0a6efd; --muted:#666; --card:#ffffff; --bg:#f4f6fb; --paper-margin:12mm;
    --danger: #dc3545; --warning: #ffc107; --success: #198754; --secondary: #374151; --info: #0dcaf0;
}
*{box-sizing:border-box}
body{font-family: "Segoe UI", Tahoma, Arial, Helvetica, sans-serif; margin:0; background:var(--bg); color:#111;}
.wrap{max-width:1140px;margin:18px auto;padding:18px;}
.card{background:var(--card);border-radius:10px;box-shadow:0 8px 30px rgba(10,20,40,0.06);padding:16px}
.form-section{border-bottom:1px solid #e5e7eb;padding-bottom:12px;margin-bottom:12px}
h1,h2,h3{margin:0 0 10px;color:var(--accent)}
h1{font-size:20px;text-align:center;} h2{font-size:16px;color:#333} h3{font-size:15px;color:var(--muted); margin-top:16px;}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 220px;min-width:180px}
label{display:block;font-weight:600;margin-bottom:6px;font-size:14px;}
input, select, textarea {width:100%;padding:8px;border:1px solid #d8dbe0;border-radius:6px;font-size:14px; background: #fff;}
.small{font-size:13px;color:var(--muted)}
.items-table, .log-table {width:100%;border-collapse:collapse;margin-top:12px; font-size: 14px; display: block; overflow-x: auto; white-space: nowrap;}
.items-table th,.items-table td, .log-table th, .log-table td {border:1px solid #e5e7eb;padding:8px;text-align:center; vertical-align: middle;}
.items-table th, .log-table th {background:#fbfdff;font-weight:700}
.btn{display:inline-block;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:var(--accent);color:#fff;font-weight:700; font-size: 14px; margin: 2px;}
.btn.info{background: var(--info); color: #000;} .btn.secondary{background:var(--secondary)} .btn.success{background:var(--success)}
.btn.danger{background:var(--danger)} .btn.warning{background:var(--warning); color: #111;}
.btn.small-action{padding: 4px 8px; font-size: 12px;}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-bottom: 12px; justify-content: center; align-items: center;}
.customer-col { position: relative; }
.customer-balance-display { font-size: 12px; font-weight: bold; color: var(--accent); white-space: nowrap; position: absolute; bottom: -18px; left: 0;}
body[dir="rtl"] .customer-balance-display { left: auto; right: 0;}

.preview, .statement-preview {display:none; margin-top:18px;padding:20px;border-radius:8px;background:#fff;border:1px solid #eef2ff}
.tabs-nav, .sub-tabs-nav { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 16px; flex-wrap: wrap;}
.tab-btn, .sub-tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: transparent; font-size: 16px; font-weight: 600; color: var(--muted); border-bottom: 2px solid transparent; margin-bottom: -2px; }
.tab-btn.active, .sub-tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
.tab-content, .sub-tab-content { display: none; }
.tab-content.active, .sub-tab-content.active { display: block; animation: fadeIn 0.5s; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.header-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px;}
.header-buttons { display: flex; gap: 8px; align-items: center; }
.welcome-user {font-weight: bold; margin: 0 10px; color: var(--muted); font-size: 14px;}
.summary { text-align: left; padding: 10px; border-top: 1px solid #eee; margin-top: 10px;}
body[dir="rtl"] .summary { text-align: right; }
.summary p { margin: 5px 0; font-size: 15px;}

/* Preview Styles */
.preview-client-details {margin-top:20px; background: #f9f9f9; padding: 12px; border-radius: 6px;}
.preview-client-details .detail-row { display: flex; margin-bottom: 4px; font-size: 14px;}
.preview-client-details .detail-label { font-weight: bold; min-width: 120px; }
body[dir="ltr"] .preview-client-details .detail-label { min-width: 150px; }
.qr-block{text-align:center}
#qrContainer { width: 140px; height: 140px; margin: auto; padding: 4px; background: white; border: 1px solid #eee; }
#qrContainer canvas, #qrContainer img { display: block; width: 100% !important; height: 100% !important; }
.invoice-preview .inv-header { display: flex; justify-content: space-between; align-items: flex-start; }
.invoice-preview .seller-block { text-align: right; }
body[dir="ltr"] .invoice-preview .seller-block { text-align: left; }
.invoice-preview .seller-block h2 { font-size: 22px; color: #000; margin-bottom: 8px;}
.invoice-preview .invoice-title { text-align: center; margin: 20px 0; font-size: 24px; color: #333; text-decoration: underline;}
.preview-meta {margin-top:20px; border-top:1px solid #eee; padding-top:10px; display:flex; justify-content: space-between;}
.meta-value {font-weight: 700;}
.preview-items-container {margin-top:20px;}
.preview-totals-container {margin-top:20px; padding-top:10px; border-top: 1px solid #eee;}
.receipt-preview .receipt-header, .statement-preview .statement-header {text-align:center; margin-bottom: 20px;}
.receipt-preview .receipt-title {text-align:center; font-size: 1.2em; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 15px;}
.receipt-details-table {width:100%; border-collapse:collapse; font-size: 1em; text-align: right;}
body[dir="ltr"] .receipt-details-table {text-align: left;}
.receipt-details-table td {padding: 6px;}
.receipt-label {font-weight: bold;}
.receipt-signatures, .statement-summary {margin-top: 40px; display: flex; justify-content: space-between; font-size: 0.9em;}
.statement-client-info {margin-bottom: 20px; padding: 10px; border: 1px solid #eee; border-radius: 6px;}

/* === START: AGGRESSIVE MOBILE FIX === */
@media (max-width: 768px) {
    /* --- إعادة تعيين تخطيط الصفحة والبطاقة --- */
    .wrap {
        padding: 8px;
        margin: 0;
    }
    .card {
        padding: 12px;
    }
    .header-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    .header-controls h1 {
        text-align: center;
        font-size: 18px;
    }
    .header-buttons {
        flex-direction: column;
        gap: 8px;
    }

    /* 
     *  === إعادة تعيين قوية لمسافات النموذج ===
     *  هذا هو الجزء الأهم. نحن نفرض إعادة تعيين كاملة للتخطيط.
    */

    /* الخطوة 1: إعادة تعيين الحاوية الرئيسية للحقول */
    .form-section {
        padding: 10px 0 !important; /* فرض الحشوة لتكون عمودية فقط */
        margin: 0 !important;      /* إزالة كل الهوامش الخارجية */
        border-bottom: 1px solid #e5e7eb;
    }
    .form-section + .form-section {
        margin-top: 15px !important; /* إضافة مسافة متحكم بها بين الأقسام */
    }

    /* الخطوة 2: إعادة تعيين حاوية الصفوف */
    .row {
        display: block !important; /* إلغاء تخطيط Flexbox تمامًا والتعامل معها ككتل بسيطة */
        margin: 0 !important;
        padding: 0 !important;
    }
    
    /* الخطوة 3: التحكم المباشر في حاويات حقول الإدخال */
    .col {
        display: block !important; /* التأكد من أنها تتصرف ككتلة بسيطة */
        padding: 0 !important;     /* إزالة أي حشوة داخلية */
        margin: 0 !important;      /* إزالة كل الهوامش الخارجية */
        width: 100% !important;    /* فرض عرض كامل */
    }
    
    /* 
     * الخطوة 4 (المتحكم الوحيد): إضافة هامش متحكم به *فقط* بين حقول الإدخال.
     * هذا هو المكان الوحيد الآن الذي يتحكم في المسافة.
    */
    .col + .col {
        margin-top: 18px !important; /* <<< قم بتعديل هذه القيمة (18px) حسب رغبتك لتكبير أو تصغير المسافة */
    }
    
    /* الخطوة 5: تعديل مسافة العناوين فوق الحقول */
    label {
        margin-bottom: 4px; /* تقليل المسافة بين العنوان ومربع الإدخال */
    }
    
    h2 {
        font-size: 16px;
        margin-bottom: 15px; /* مسافة تحت العناوين مثل "بيانات الفاتورة والعميل" */
    }
    /* === نهاية إعادة التعيين القوية === */


    /* --- بقية الأنماط للجوال --- */
    .tabs-nav, .sub-tabs-nav {
        justify-content: flex-start;
        overflow-x: auto;
    }
    .tab-btn, .sub-tab-btn {
        white-space: nowrap;
        font-size: 14px;
        padding: 8px 10px;
    }
    .actions {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin-top: 20px;
    }
    .actions .btn {
        width: 100%;
        margin: 0;
    }
    .log-table .actions {
        flex-direction: column;
        gap: 5px;
    }
    .log-table .btn.small-action {
        width: 90%;
        margin: 2px auto;
    }
    .invoice-preview .inv-header {
        flex-direction: column;
        align-items: center;
    }
}
/* === END OF MOBILE FIX === */


/* Print Styles */
@media print {
    body {
        background: white;
        color: black;
    }
    .wrap, .card {
        box-shadow: none;
        max-width: 100%;
        margin: 0;
        padding: 0;
        border-radius: 0;
    }
    .no-print {
        display: none !important;
    }
    .preview, .statement-preview {
        display: none !important;
        border: none;
        margin: 0;
        padding: 0;
        border-radius: 0;
    }
    body.printing-invoice .invoice-preview {
        display: block !important;
    }
    body.printing-receipt .receipt-preview {
        display: block !important;
    }
    body.printing-statement .statement-preview {
        display: block !important;
    }
    .items-table {
        display: table;
        overflow-x: hidden;
        white-space: normal;
    }
    @page {
        size: A4;
        margin: var(--paper-margin);
    }
}

/* Print Styles */
@media print{
    body{background:white; color:black;}
    .wrap, .card {box-shadow:none;max-width:100%;margin:0;padding:0;border-radius:0;}
    .no-print {display:none !important}
    .preview, .statement-preview { display: none !important; border:none;margin:0;padding:0;border-radius:0;}
    body.printing-invoice .invoice-preview { display: block !important; }
    body.printing-receipt .receipt-preview { display: block !important; }
    body.printing-statement .statement-preview { display: block !important; }
    .items-table { display: table; overflow-x: hidden; white-space: normal; }
    @page { size: A4; margin: var(--paper-margin); }
}

/* Print Styles */
@media print{
    body{background:white; color:black;}
    .wrap, .card {box-shadow:none;max-width:100%;margin:0;padding:0;border-radius:0;}
    .no-print {display:none !important}
    .preview, .statement-preview { display: none !important; border:none;margin:0;padding:0;border-radius:0;}
    body.printing-invoice .invoice-preview { display: block !important; }
    body.printing-receipt .receipt-preview { display: block !important; }
    body.printing-statement .statement-preview { display: block !important; }
    .items-table { display: table; overflow-x: hidden; white-space: normal; }
    @page { size: A4; margin: var(--paper-margin); }
}
